<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Management Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-gray-100">
  <!-- Sidebar -->
  <div id="sidebar" class="fixed inset-y-0 left-0 w-64 bg-white shadow-lg z-30 flex flex-col transition-transform duration-300 transform translate-x-0 md:translate-x-0">
    <div class="flex items-center justify-center h-20 border-b">
      <span class="text-xl font-bold text-blue-600">Admin Panel</span>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2">
      <button class="w-full flex items-center px-4 py-2 rounded hover:bg-blue-100 text-blue-700 font-semibold" onclick="showSection('dashboard')">
        <i class="fa fa-chart-pie mr-3"></i> Dashboard
      </button>
      <button class="w-full flex items-center px-4 py-2 rounded hover:bg-blue-100 text-blue-700 font-semibold" onclick="showSection('students')">
        <i class="fa fa-user-graduate mr-3"></i> Students
      </button>
      <button class="w-full flex items-center px-4 py-2 rounded hover:bg-blue-100 text-blue-700 font-semibold" onclick="showSection('faculty')">
        <i class="fa fa-chalkboard-teacher mr-3"></i> Faculty
      </button>
      <button class="w-full flex items-center px-4 py-2 rounded hover:bg-blue-100 text-blue-700 font-semibold" onclick="showSection('courses')">
        <i class="fa fa-book mr-3"></i> Courses
      </button>
      <button class="w-full flex items-center px-4 py-2 rounded hover:bg-blue-100 text-blue-700 font-semibold" onclick="showSection('departments')">
        <i class="fa fa-building mr-3"></i> Departments
      </button>
      <button class="w-full flex items-center px-4 py-2 rounded hover:bg-blue-100 text-blue-700 font-semibold" onclick="showSection('users')">
        <i class="fa fa-users-cog mr-3"></i> Admin Users
      </button>
    </nav>
  </div>

  <!-- Top Navbar -->
  <div class="ml-0 md:ml-64 bg-white shadow h-16 flex items-center justify-between px-6 fixed w-full z-20">
    <div class="flex items-center">
      <button class="md:hidden text-blue-600 mr-4" onclick="toggleSidebar()">
        <i class="fa fa-bars fa-lg"></i>
      </button>
      <span class="font-semibold text-lg text-blue-700">Academic Management System</span>
    </div>
    <div class="flex items-center space-x-4">
      <span class="text-gray-700">Admin</span>
      <img src="https://i.pravatar.cc/40?img=3" alt="profile" class="rounded-full w-8 h-8 border">
      <button class="text-gray-500 hover:text-blue-600"><i class="fa fa-cog"></i></button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="pt-20 md:ml-64 px-4 transition-all duration-300">
    <!-- Dashboard Section -->
    <section id="dashboard-section" class="section">
      <h2 class="text-2xl font-bold mb-4 text-blue-700">Dashboard Overview</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white rounded shadow p-4 flex flex-col items-center">
          <i class="fa fa-user-graduate fa-2x text-blue-500 mb-2"></i>
          <span class="text-lg font-semibold">Total Students</span>
          <span id="total-students" class="text-2xl font-bold text-blue-700">0</span>
        </div>
        <div class="bg-white rounded shadow p-4 flex flex-col items-center">
          <i class="fa fa-chalkboard-teacher fa-2x text-green-500 mb-2"></i>
          <span class="text-lg font-semibold">Total Faculty</span>
          <span id="total-faculty" class="text-2xl font-bold text-green-700">0</span>
        </div>
        <div class="bg-white rounded shadow p-4 flex flex-col items-center">
          <i class="fa fa-book fa-2x text-purple-500 mb-2"></i>
          <span class="text-lg font-semibold">Courses Offered</span>
          <span id="total-courses" class="text-2xl font-bold text-purple-700">0</span>
        </div>
        <div class="bg-white rounded shadow p-4 flex flex-col items-center">
          <i class="fa fa-building fa-2x text-yellow-500 mb-2"></i>
          <span class="text-lg font-semibold">Departments</span>
          <span id="total-departments" class="text-2xl font-bold text-yellow-700">0</span>
        </div>
      </div>
      <div class="bg-white rounded shadow p-4">
        <h3 class="text-lg font-semibold mb-2 text-blue-700">Recent Activity Logs</h3>
        <ul id="activity-logs" class="list-disc pl-5 text-gray-700">
          <!-- Activity logs will be injected here -->
        </ul>
      </div>
    </section>

    <!-- Students Section -->
    <section id="students-section" class="section hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-blue-700">Student Management</h2>
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="openStudentModal()">Add Student</button>
      </div>
      <div class="mb-2 flex flex-wrap gap-2">
        <input type="text" id="student-search" class="border rounded px-2 py-1 w-48" placeholder="Search by name or ID" oninput="renderStudentTable()">
        <select id="student-filter" class="border rounded px-2 py-1" onchange="renderStudentTable()">
          <option value="">All Status</option>
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded shadow">
          <thead>
            <tr class="bg-blue-100">
              <th class="py-2 px-4 text-left">ID</th>
              <th class="py-2 px-4 text-left">Name</th>
              <th class="py-2 px-4 text-left">Course</th>
              <th class="py-2 px-4 text-left">Year</th>
              <th class="py-2 px-4 text-left">Email</th>
              <th class="py-2 px-4 text-left">Status</th>
              <th class="py-2 px-4 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="student-table">
            <!-- Student rows injected here -->
          </tbody>
        </table>
      </div>
      <div class="mt-2 flex justify-end">
        <button id="student-prev" class="px-2 py-1 border rounded mr-2" onclick="studentPrevPage()">Prev</button>
        <span id="student-page-info" class="px-2 py-1"></span>
        <button id="student-next" class="px-2 py-1 border rounded ml-2" onclick="studentNextPage()">Next</button>
      </div>
    </section>

    <!-- Faculty Section -->
    <section id="faculty-section" class="section hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-blue-700">Faculty Management</h2>
        <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="openFacultyModal()">Add Faculty</button>
      </div>
      <div class="mb-2 flex flex-wrap gap-2">
        <input type="text" id="faculty-search" class="border rounded px-2 py-1 w-48" placeholder="Search by name or ID" oninput="renderFacultyTable()">
        <select id="faculty-filter" class="border rounded px-2 py-1" onchange="renderFacultyTable()">
          <option value="">All Departments</option>
          <!-- Department options injected -->
        </select>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded shadow">
          <thead>
            <tr class="bg-green-100">
              <th class="py-2 px-4 text-left">ID</th>
              <th class="py-2 px-4 text-left">Name</th>
              <th class="py-2 px-4 text-left">Department</th>
              <th class="py-2 px-4 text-left">Courses</th>
              <th class="py-2 px-4 text-left">Email</th>
              <th class="py-2 px-4 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="faculty-table">
            <!-- Faculty rows injected here -->
          </tbody>
        </table>
      </div>
      <div class="mt-2 flex justify-end">
        <button id="faculty-prev" class="px-2 py-1 border rounded mr-2" onclick="facultyPrevPage()">Prev</button>
        <span id="faculty-page-info" class="px-2 py-1"></span>
        <button id="faculty-next" class="px-2 py-1 border rounded ml-2" onclick="facultyNextPage()">Next</button>
      </div>
    </section>

    <!-- Courses Section -->
    <section id="courses-section" class="section hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-purple-700">Course Management</h2>
        <button class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700" onclick="openCourseModal()">Add Course</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded shadow">
          <thead>
            <tr class="bg-purple-100">
              <th class="py-2 px-4 text-left">Code</th>
              <th class="py-2 px-4 text-left">Name</th>
              <th class="py-2 px-4 text-left">Department</th>
              <th class="py-2 px-4 text-left">Faculty</th>
              <th class="py-2 px-4 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="course-table">
            <!-- Course rows injected here -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Departments Section -->
    <section id="departments-section" class="section hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-yellow-700">Department Management</h2>
        <button class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700" onclick="openDepartmentModal()">Add Department</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded shadow">
          <thead>
            <tr class="bg-yellow-100">
              <th class="py-2 px-4 text-left">Code</th>
              <th class="py-2 px-4 text-left">Name</th>
              <th class="py-2 px-4 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="department-table">
            <!-- Department rows injected here -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Admin Users Section -->
    <section id="users-section" class="section hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-blue-700">Admin User Management</h2>
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="openUserModal()">Add Admin</button>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded shadow">
          <thead>
            <tr class="bg-blue-100">
              <th class="py-2 px-4 text-left">Username</th>
              <th class="py-2 px-4 text-left">Role</th>
              <th class="py-2 px-4 text-left">Actions</th>
            </tr>
          </thead>
          <tbody id="user-table">
            <!-- User rows injected here -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modals -->
  <div id="modal-bg" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
  <!-- Student Modal -->
  <div id="student-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded shadow-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4" id="student-modal-title">Add Student</h3>
      <form id="student-form" class="space-y-3" onsubmit="submitStudentForm(event)">
        <input type="hidden" id="student-id">
        <div>
          <label class="block text-sm font-semibold">Name</label>
          <input type="text" id="student-name" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Course</label>
          <input type="text" id="student-course" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Year Level</label>
          <input type="number" id="student-year" class="border rounded px-2 py-1 w-full" min="1" max="5" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Email</label>
          <input type="email" id="student-email" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Status</label>
          <select id="student-status" class="border rounded px-2 py-1 w-full" required>
            <option value="Active">Active</option>
            <option value="Inactive">Inactive</option>
          </select>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400" onclick="closeModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Faculty Modal -->
  <div id="faculty-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded shadow-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4" id="faculty-modal-title">Add Faculty</h3>
      <form id="faculty-form" class="space-y-3" onsubmit="submitFacultyForm(event)">
        <input type="hidden" id="faculty-id">
        <div>
          <label class="block text-sm font-semibold">Name</label>
          <input type="text" id="faculty-name" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Department</label>
          <select id="faculty-department" class="border rounded px-2 py-1 w-full" required>
            <!-- Department options injected -->
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold">Courses</label>
          <input type="text" id="faculty-courses" class="border rounded px-2 py-1 w-full" placeholder="Comma separated">
        </div>
        <div>
          <label class="block text-sm font-semibold">Email</label>
          <input type="email" id="faculty-email" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400" onclick="closeModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">Save</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Course Modal -->
  <div id="course-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded shadow-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4" id="course-modal-title">Add Course</h3>
      <form id="course-form" class="space-y-3" onsubmit="submitCourseForm(event)">
        <input type="hidden" id="course-code">
        <div>
          <label class="block text-sm font-semibold">Course Name</label>
          <input type="text" id="course-name" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Department</label>
          <select id="course-department" class="border rounded px-2 py-1 w-full" required>
            <!-- Department options injected -->
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold">Faculty</label>
          <select id="course-faculty" class="border rounded px-2 py-1 w-full">
            <!-- Faculty options injected -->
          </select>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400" onclick="closeModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-purple-600 text-white hover:bg-purple-700">Save</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Department Modal -->
  <div id="department-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded shadow-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4" id="department-modal-title">Add Department</h3>
      <form id="department-form" class="space-y-3" onsubmit="submitDepartmentForm(event)">
        <input type="hidden" id="department-code">
        <div>
          <label class="block text-sm font-semibold">Department Name</label>
          <input type="text" id="department-name" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400" onclick="closeModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-yellow-600 text-white hover:bg-yellow-700">Save</button>
        </div>
      </form>
    </div>
  </div>
  <!-- User Modal -->
  <div id="user-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded shadow-lg w-full max-w-md p-6">
      <h3 class="text-xl font-bold mb-4" id="user-modal-title">Add Admin User</h3>
      <form id="user-form" class="space-y-3" onsubmit="submitUserForm(event)">
        <input type="hidden" id="user-username">
        <div>
          <label class="block text-sm font-semibold">Username</label>
          <input type="text" id="user-name" class="border rounded px-2 py-1 w-full" required>
        </div>
        <div>
          <label class="block text-sm font-semibold">Role</label>
          <select id="user-role" class="border rounded px-2 py-1 w-full" required>
            <option value="Super Admin">Super Admin</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400" onclick="closeModal()">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript Functionality -->
  <script>
    // Mock Data
    let students = [
      { id: 'S001', name: 'Alice Smith', course: 'BSCS', year: 2, email: 'alice@school.edu', status: 'Active' },
      { id: 'S002', name: 'Bob Johnson', course: 'BSIT', year: 3, email: 'bob@school.edu', status: 'Inactive' },
      { id: 'S003', name: 'Carol Lee', course: 'BSCS', year: 1, email: 'carol@school.edu', status: 'Active' }
    ];
    let faculty = [
      { id: 'F001', name: 'Dr. John Doe', department: 'CS', courses: ['BSCS101', 'BSCS102'], email: 'john@school.edu' },
      { id: 'F002', name: 'Prof. Jane Roe', department: 'IT', courses: ['BSIT101'], email: 'jane@school.edu' }
    ];
    let departments = [
      { code: 'CS', name: 'Computer Science' },
      { code: 'IT', name: 'Information Technology' }
    ];
    let courses = [
      { code: 'BSCS101', name: 'Intro to CS', department: 'CS', faculty: 'F001' },
      { code: 'BSIT101', name: 'Intro to IT', department: 'IT', faculty: 'F002' }
    ];
    let users = [
      { username: 'admin1', role: 'Super Admin' },
      { username: 'admin2', role: 'Admin' }
    ];
    let activityLogs = [
      'Added new student Alice Smith',
      'Faculty Dr. John Doe assigned to BSCS101',
      'Course BSIT101 created',
      'Admin admin2 added'
    ];

    // Pagination
    let studentPage = 1, studentPageSize = 5;
    let facultyPage = 1, facultyPageSize = 5;

    // Sidebar toggle
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('-translate-x-64');
    }

    // Section navigation
    function showSection(section) {
      document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
      document.getElementById(section + '-section').classList.remove('hidden');
    }

    // Modal handling
    function openStudentModal(editId = null) {
      document.getElementById('modal-bg').classList.remove('hidden');
      document.getElementById('student-modal').classList.remove('hidden');
      document.getElementById('student-form').reset();
      if (editId) {
        const s = students.find(stu => stu.id === editId);
        document.getElementById('student-modal-title').innerText = 'Edit Student';
        document.getElementById('student-id').value = s.id;
        document.getElementById('student-name').value = s.name;
        document.getElementById('student-course').value = s.course;
        document.getElementById('student-year').value = s.year;
        document.getElementById('student-email').value = s.email;
        document.getElementById('student-status').value = s.status;
      } else {
        document.getElementById('student-modal-title').innerText = 'Add Student';
        document.getElementById('student-id').value = '';
      }
    }
    function openFacultyModal(editId = null) {
      document.getElementById('modal-bg').classList.remove('hidden');
      document.getElementById('faculty-modal').classList.remove('hidden');
      document.getElementById('faculty-form').reset();
      // Populate department options
      let deptSel = document.getElementById('faculty-department');
      deptSel.innerHTML = departments.map(d => `<option value="${d.code}">${d.name}</option>`).join('');
      if (editId) {
        const f = faculty.find(fac => fac.id === editId);
        document.getElementById('faculty-modal-title').innerText = 'Edit Faculty';
        document.getElementById('faculty-id').value = f.id;
        document.getElementById('faculty-name').value = f.name;
        document.getElementById('faculty-department').value = f.department;
        document.getElementById('faculty-courses').value = f.courses.join(', ');
        document.getElementById('faculty-email').value = f.email;
      } else {
        document.getElementById('faculty-modal-title').innerText = 'Add Faculty';
        document.getElementById('faculty-id').value = '';
      }
    }
    function openCourseModal(editCode = null) {
      document.getElementById('modal-bg').classList.remove('hidden');
      document.getElementById('course-modal').classList.remove('hidden');
      document.getElementById('course-form').reset();
      // Populate department options
      let deptSel = document.getElementById('course-department');
      deptSel.innerHTML = departments.map(d => `<option value="${d.code}">${d.name}</option>`).join('');
      // Populate faculty options
      let facSel = document.getElementById('course-faculty');
      facSel.innerHTML = faculty.map(f => `<option value="${f.id}">${f.name}</option>`).join('');
      if (editCode) {
        const c = courses.find(cou => cou.code === editCode);
        document.getElementById('course-modal-title').innerText = 'Edit Course';
        document.getElementById('course-code').value = c.code;
        document.getElementById('course-name').value = c.name;
        document.getElementById('course-department').value = c.department;
        document.getElementById('course-faculty').value = c.faculty;
      } else {
        document.getElementById('course-modal-title').innerText = 'Add Course';
        document.getElementById('course-code').value = '';
      }
    }
    function openDepartmentModal(editCode = null) {
      document.getElementById('modal-bg').classList.remove('hidden');
      document.getElementById('department-modal').classList.remove('hidden');
      document.getElementById('department-form').reset();
      if (editCode) {
        const d = departments.find(dep => dep.code === editCode);
        document.getElementById('department-modal-title').innerText = 'Edit Department';
        document.getElementById('department-code').value = d.code;
        document.getElementById('department-name').value = d.name;
      } else {
        document.getElementById('department-modal-title').innerText = 'Add Department';
        document.getElementById('department-code').value = '';
      }
    }
    function openUserModal(editUsername = null) {
      document.getElementById('modal-bg').classList.remove('hidden');
      document.getElementById('user-modal').classList.remove('hidden');
      document.getElementById('user-form').reset();
      if (editUsername) {
        const u = users.find(u => u.username === editUsername);
        document.getElementById('user-modal-title').innerText = 'Edit Admin User';
        document.getElementById('user-username').value = u.username;
        document.getElementById('user-name').value = u.username;
        document.getElementById('user-role').value = u.role;
      } else {
        document.getElementById('user-modal-title').innerText = 'Add Admin User';
        document.getElementById('user-username').value = '';
      }
    }
    function closeModal() {
      document.getElementById('modal-bg').classList.add('hidden');
      document.querySelectorAll('.fixed.z-50').forEach(m => m.classList.add('hidden'));
    }

    // Dashboard rendering
    function renderDashboard() {
      document.getElementById('total-students').innerText = students.length;
      document.getElementById('total-faculty').innerText = faculty.length;
      document.getElementById('total-courses').innerText = courses.length;
      document.getElementById('total-departments').innerText = departments.length;
      document.getElementById('activity-logs').innerHTML = activityLogs.slice(0, 5).map(log => `<li>${log}</li>`).join('');
    }

    // Student Table rendering, search, filter, pagination
    function renderStudentTable() {
      let search = document.getElementById('student-search').value.toLowerCase();
      let filter = document.getElementById('student-filter').value;
      let filtered = students.filter(s =>
        (s.name.toLowerCase().includes(search) || s.id.toLowerCase().includes(search)) &&
        (filter === '' || s.status === filter)
      );
      let totalPages = Math.ceil(filtered.length / studentPageSize);
      if (studentPage > totalPages) studentPage = totalPages || 1;
      let start = (studentPage - 1) * studentPageSize;
      let pageData = filtered.slice(start, start + studentPageSize);
      document.getElementById('student-table').innerHTML = pageData.map(s => `
        <tr class="hover:bg-blue-50 ${start % 2 === 0 ? 'bg-gray-50' : ''}">
          <td class="py-2 px-4">${s.id}</td>
          <td class="py-2 px-4">${s.name}</td>
          <td class="py-2 px-4">${s.course}</td>
          <td class="py-2 px-4">${s.year}</td>
          <td class="py-2 px-4">${s.email}</td>
          <td class="py-2 px-4">${s.status}</td>
          <td class="py-2 px-4 flex gap-2">
            <button class="text-blue-600 hover:underline" onclick="openStudentModal('${s.id}')">Edit</button>
            <button class="text-red-600 hover:underline" onclick="deleteStudent('${s.id}')">Delete</button>
          </td>
        </tr>
      `).join('');
      document.getElementById('student-page-info').innerText = `Page ${studentPage} of ${totalPages || 1}`;
    }
    function studentPrevPage() {
      if (studentPage > 1) studentPage--;
      renderStudentTable();
    }
    function studentNextPage() {
      let search = document.getElementById('student-search').value.toLowerCase();
      let filter = document.getElementById('student-filter').value;
      let filtered = students.filter(s =>
        (s.name.toLowerCase().includes(search) || s.id.toLowerCase().includes(search)) &&
        (filter === '' || s.status === filter)
      );
      let totalPages = Math.ceil(filtered.length / studentPageSize);
      if (studentPage < totalPages) studentPage++;
      renderStudentTable();
    }
    function submitStudentForm(e) {
      e.preventDefault();
      let id = document.getElementById('student-id').value;
      let name = document.getElementById('student-name').value.trim();
      let course = document.getElementById('student-course').value.trim();
      let year = parseInt(document.getElementById('student-year').value);
      let email = document.getElementById('student-email').value.trim();
      let status = document.getElementById('student-status').value;
      if (!name || !course || !year || !email || !status) return;
      if (id) {
        let s = students.find(stu => stu.id === id);
        s.name = name; s.course = course; s.year = year; s.email = email; s.status = status;
        activityLogs.unshift(`Edited student ${name}`);
      } else {
        let newId = 'S' + String(students.length + 1).padStart(3, '0');
        students.push({ id: newId, name, course, year, email, status });
        activityLogs.unshift(`Added new student ${name}`);
      }
      closeModal();
      renderStudentTable();
      renderDashboard();
    }
    function deleteStudent(id) {
      if (confirm('Delete this student?')) {
        let idx = students.findIndex(s => s.id === id);
        activityLogs.unshift(`Deleted student ${students[idx].name}`);
        students.splice(idx, 1);
        renderStudentTable();
        renderDashboard();
      }
    }

    // Faculty Table rendering, search, filter, pagination
    function renderFacultyTable() {
      let search = document.getElementById('faculty-search').value.toLowerCase();
      let filter = document.getElementById('faculty-filter').value;
      let filtered = faculty.filter(f =>
        (f.name.toLowerCase().includes(search) || f.id.toLowerCase().includes(search)) &&
        (filter === '' || f.department === filter)
      );
      let totalPages = Math.ceil(filtered.length / facultyPageSize);
      if (facultyPage > totalPages) facultyPage = totalPages || 1;
      let start = (facultyPage - 1) * facultyPageSize;
      let pageData = filtered.slice(start, start + facultyPageSize);
      document.getElementById('faculty-table').innerHTML = pageData.map(f => `
        <tr class="hover:bg-green-50 ${start % 2 === 0 ? 'bg-gray-50' : ''}">
          <td class="py-2 px-4">${f.id}</td>
          <td class="py-2 px-4">${f.name}</td>
          <td class="py-2 px-4">${f.department}</td>
          <td class="py-2 px-4">${f.courses.join(', ')}</td>
          <td class="py-2 px-4">${f.email}</td>
          <td class="py-2 px-4 flex gap-2">
            <button class="text-green-600 hover:underline" onclick="openFacultyModal('${f.id}')">Edit</button>
            <button class="text-red-600 hover:underline" onclick="deleteFaculty('${f.id}')">Delete</button>
          </td>
        </tr>
      `).join('');
      document.getElementById('faculty-page-info').innerText = `Page ${facultyPage} of ${totalPages || 1}`;
      // Populate department filter
      let deptSel = document.getElementById('faculty-filter');
      deptSel.innerHTML = `<option value="">All Departments</option>` + departments.map(d => `<option value="${d.code}">${d.name}</option>`).join('');
    }
    function facultyPrevPage() {
      if (facultyPage > 1) facultyPage--;
      renderFacultyTable();
    }
    function facultyNextPage() {
      let search = document.getElementById('faculty-search').value.toLowerCase();
      let filter = document.getElementById('faculty-filter').value;
      let filtered = faculty.filter(f =>
        (f.name.toLowerCase().includes(search) || f.id.toLowerCase().includes(search)) &&
        (filter === '' || f.department === filter)
      );
      let totalPages = Math.ceil(filtered.length / facultyPageSize);
      if (facultyPage < totalPages) facultyPage++;
      renderFacultyTable();
    }
    function submitFacultyForm(e) {
      e.preventDefault();
      let id = document.getElementById('faculty-id').value;
      let name = document.getElementById('faculty-name').value.trim();
      let department = document.getElementById('faculty-department').value;
      let coursesStr = document.getElementById('faculty-courses').value.trim();
      let coursesArr = coursesStr ? coursesStr.split(',').map(c => c.trim()) : [];
      let email = document.getElementById('faculty-email').value.trim();
      if (!name || !department || !email) return;
      if (id) {
        let f = faculty.find(fac => fac.id === id);
        f.name = name; f.department = department; f.courses = coursesArr; f.email = email;
        activityLogs.unshift(`Edited faculty ${name}`);
      } else {
        let newId = 'F' + String(faculty.length + 1).padStart(3, '0');
        faculty.push({ id: newId, name, department, courses: coursesArr, email });
        activityLogs.unshift(`Added new faculty ${name}`);
      }
      closeModal();
      renderFacultyTable();
      renderDashboard();
    }
    function deleteFaculty(id) {
      if (confirm('Delete this faculty?')) {
        let idx = faculty.findIndex(f => f.id === id);
        activityLogs.unshift(`Deleted faculty ${faculty[idx].name}`);
        faculty.splice(idx, 1);
        renderFacultyTable();
        renderDashboard();
      }
    }

    // Course Table rendering
    function renderCourseTable() {
      document.getElementById('course-table').innerHTML = courses.map(c => {
        let dept = departments.find(d => d.code === c.department)?.name || c.department;
        let fac = faculty.find(f => f.id === c.faculty)?.name || c.faculty;
        return `
          <tr class="hover:bg-purple-50">
            <td class="py-2 px-4">${c.code}</td>
            <td class="py-2 px-4">${c.name}</td>
            <td class="py-2 px-4">${dept}</td>
            <td class="py-2 px-4">${fac}</td>
            <td class="py-2 px-4 flex gap-2">
              <button class="text-purple-600 hover:underline" onclick="openCourseModal('${c.code}')">Edit</button>
              <button class="text-red-600 hover:underline" onclick="deleteCourse('${c.code}')">Delete</button>
            </td>
          </tr>
        `;
      }).join('');
    }
    function submitCourseForm(e) {
      e.preventDefault();
      let code = document.getElementById('course-code').value;
      let name = document.getElementById('course-name').value.trim();
      let department = document.getElementById('course-department').value;
      let facultyId = document.getElementById('course-faculty').value;
      if (!name || !department || !facultyId) return;
      if (code) {
        let c = courses.find(cou => cou.code === code);
        c.name = name; c.department = department; c.faculty = facultyId;
        activityLogs.unshift(`Edited course ${name}`);
      } else {
        let newCode = name.replace(/\s+/g, '').toUpperCase().slice(0, 8) + String(courses.length + 1);
        courses.push({ code: newCode, name, department, faculty: facultyId });
        activityLogs.unshift(`Added new course ${name}`);
      }
      closeModal();
      renderCourseTable();
      renderDashboard();
    }
    function deleteCourse(code) {
      if (confirm('Delete this course?')) {
        let idx = courses.findIndex(c => c.code === code);
        activityLogs.unshift(`Deleted course ${courses[idx].name}`);
        courses.splice(idx, 1);
        renderCourseTable();
        renderDashboard();
      }
    }

    // Department Table rendering
    function renderDepartmentTable() {
      document.getElementById('department-table').innerHTML = departments.map(d => `
        <tr class="hover:bg-yellow-50">
          <td class="py-2 px-4">${d.code}</td>
          <td class="py-2 px-4">${d.name}</td>
          <td class="py-2 px-4 flex gap-2">
            <button class="text-yellow-600 hover:underline" onclick="openDepartmentModal('${d.code}')">Edit</button>
            <button class="text-red-600 hover:underline" onclick="deleteDepartment('${d.code}')">Delete</button>
          </td>
        </tr>
      `).join('');
    }
    function submitDepartmentForm(e) {
      e.preventDefault();
      let code = document.getElementById('department-code').value;
      let name = document.getElementById('department-name').value.trim();
      if (!name) return;
      if (code) {
        let d = departments.find(dep => dep.code === code);
        d.name = name;
        activityLogs.unshift(`Edited department ${name}`);
      } else {
        let newCode = name.replace(/\s+/g, '').toUpperCase().slice(0, 4) + String(departments.length + 1);
        departments.push({ code: newCode, name });
        activityLogs.unshift(`Added new department ${name}`);
      }
      closeModal();
      renderDepartmentTable();
      renderDashboard();
    }
    function deleteDepartment(code) {
      if (confirm('Delete this department?')) {
        let idx = departments.findIndex(d => d.code === code);
        activityLogs.unshift(`Deleted department ${departments[idx].name}`);
        departments.splice(idx, 1);
        renderDepartmentTable();
        renderDashboard();
      }
    }

    // User Table rendering
    function renderUserTable() {
      document.getElementById('user-table').innerHTML = users.map(u => `
        <tr class="hover:bg-blue-50">
          <td class="py-2 px-4">${u.username}</td>
          <td class="py-2 px-4">${u.role}</td>
          <td class="py-2 px-4 flex gap-2">
            <button class="text-blue-600 hover:underline" onclick="openUserModal('${u.username}')">Edit</button>
            <button class="text-red-600 hover:underline" onclick="deleteUser('${u.username}')">Delete</button>
          </td>
        </tr>
      `).join('');
    }
    function submitUserForm(e) {
      e.preventDefault();
      let username = document.getElementById('user-username').value;
      let name = document.getElementById('user-name').value.trim();
      let role = document.getElementById('user-role').value;
      if (!name || !role) return;
      if (username) {
        let u = users.find(u => u.username === username);
        u.username = name; u.role = role;
        activityLogs.unshift(`Edited admin user ${name}`);
      } else {
        users.push({ username: name, role });
        activityLogs.unshift(`Added admin user ${name}`);
      }
      closeModal();
      renderUserTable();
      renderDashboard();
    }
    function deleteUser(username) {
      if (confirm('Delete this admin user?')) {
        let idx = users.findIndex(u => u.username === username);
        activityLogs.unshift(`Deleted admin user ${users[idx].username}`);
        users.splice(idx, 1);
        renderUserTable();
        renderDashboard();
      }
    }

    // Initial rendering
    function init() {
      renderDashboard();
      renderStudentTable();
      renderFacultyTable();
      renderCourseTable();
      renderDepartmentTable();
      renderUserTable();
      showSection('dashboard');
    }
    window.onload = init;
    // Close modal on background click
    document.getElementById('modal-bg').onclick = closeModal;
  </script>
</body>
</html>